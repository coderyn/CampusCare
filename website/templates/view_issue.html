{% extends "base.html" %}

{% block title %}{{ issue.title }}{% endblock %}

{% block content %}
<div class="card">
    <div class="issue-header">
        <h1>{{ issue.title }}</h1>
        <span class="status-badge {{ issue.status|get_status_color }}">{{ issue.status }}</span>
    </div>
    
    <div class="issue-details">
        <div class="detail-item">
            <strong><i class="fas fa-layer-group"></i> Category:</strong>
            <span class="category-tag">{{ issue.category }}</span>
        </div>
        
        <div class="detail-item">
            <strong><i class="fas fa-map-marker-alt"></i> Location:</strong>
            <span>{{ issue.location }}</span>
        </div>
        
        <div class="detail-item">
            <strong><i class="fas fa-exclamation-triangle"></i> Priority:</strong>
            <span class="priority-badge {{ issue.priority|get_priority_color }}">{{ issue.priority }}</span>
        </div>
        
        <div class="detail-item">
            <strong><i class="fas fa-calendar"></i> Reported:</strong>
            <span>{{ issue.created_at|format_date }}</span>
        </div>
        
        {% if issue.department %}
        <div class="detail-item">
            <strong><i class="fas fa-building"></i> Department:</strong>
            <span>{{ issue.department }}</span>
        </div>
        {% endif %}
    </div>
    
    <div class="issue-description">
        <h3><i class="fas fa-file-alt"></i> Description</h3>
        <p>{{ issue.description }}</p>
    </div>

    {% if issue.image_filename %}
    <div class="issue-image">
    <h3><i class="fas fa-image"></i> Attached Image</h3>
    <img src="{{ url_for('static', filename='uploads/' ~ issue.image_filename) }}"
         alt="Issue Image"
         class="issue-img">
    </div>
    {% endif %}

    <!-- â­ Comments section: directly under the image -->
<div class="issue-comments">
    <h3><i class="fas fa-comments"></i> Comments</h3>

    {% if issue.comments %}
        <ul class="comment-list">
            {% for comment in issue.comments %}
                <li class="comment-item">
                    <div class="comment-meta">
                        {{ comment.created_at.strftime('%Y-%m-%d %H:%M') }}
                    </div>
                    <div class="comment-content">
                        {{ comment.content }}
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No comments yet. Be the first to comment!</p>
    {% endif %}

    <form method="POST" class="comment-form">
        <div class="form-group">
            <label for="comment"><i class="fas fa-comment-dots"></i> Add a comment</label>
            <textarea id="comment" name="comment" rows="3" class="form-textarea"
                      placeholder="Write your comment here..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary btn-sm">
            <i class="fas fa-paper-plane"></i> Post Comment
        </button>
    </form>
</div>

    
    <div class="issue-actions">
        <a href="{{ url_for('issues_list') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Issues
        </a>
    </div>
</div>
{% endblock %}